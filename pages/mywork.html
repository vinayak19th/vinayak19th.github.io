--- 
layout: new_def 
title: about 
permalink: /mywork/ 
--- 

{% include publications.html %}

{% include projects.html %}

<!-- Script for filters -->
<script>
document.addEventListener('DOMContentLoaded', function () {
    function populatePaperFilters(items) {
        const uniqueTags = new Set();
        const uniqueVenues = new Set();

        items.forEach(item => {
            // Tags
            const rawTags = item.getAttribute('data-paper-tag');
            if (rawTags) {
                rawTags.split(',').forEach(tag => uniqueTags.add(tag.trim()));
            }
            // Venues
            const venue = item.getAttribute('data-paper-venue');
            if (venue) {
                uniqueVenues.add(venue.trim());
            }
        });

        // Populate Tags
        const tagSelect = document.getElementById('paper-tag-filter-options');
        if (tagSelect) {
            Array.from(uniqueTags).sort().forEach(tag => {
                const option = document.createElement('div');
                option.className = 'dropdown-option';
                option.dataset.value = tag;
                option.textContent = tag;
                tagSelect.appendChild(option);
            });
        }

        // Populate Venues
        const venueSelect = document.getElementById('paper-venue-filter-options');
        if(venueSelect){ // Check if element exists
             Array.from(uniqueVenues).sort().forEach(venue => {
                const option = document.createElement('div');
                option.className = 'dropdown-option';
                option.dataset.value = venue;
                // Truncate if too long (e.g. > 50 chars)
                if (venue.length > 50) {
                    option.textContent = venue.substring(0, 47) + '...';
                } else {
                    option.textContent = venue;
                }
                venueSelect.appendChild(option);
            });
        }
    }

    function applyFilters(filterSelects,items) {
        // Create an object to hold the current filter values
        const activeFilters = {};
        filterSelects.forEach(select => {
            const filterGroup = select.getAttribute('data-filter-group');
            activeFilters[filterGroup] = select.value;
        });

        // Loop through each publication and check if well ALL active filters
        items.forEach(item => {
            let isVisible = true; // Assume the item is visible by default

            for (const groupKey in activeFilters) {
            const filterValue = activeFilters[groupKey];
            let group = groupKey;
            let rangeType = null; // 'min' or 'max'

            if (groupKey.endsWith('-min')) {
                group = groupKey.replace('-min', '');
                rangeType = 'min';
            } else if (groupKey.endsWith('-max')) {
                 group = groupKey.replace('-max', '');
                 rangeType = 'max';
            }

            const itemValue = item.getAttribute(`data-${group}`);
            
            // If a filter is set (not 'all') and the item doesn't match, hide it
            if (filterValue !== 'all') {
                if (rangeType) {
                    // Numerical Range Comparison
                    const itemNum = parseFloat(itemValue);
                    const filterNum = parseFloat(filterValue);
                    
                    if (!isNaN(itemNum) && !isNaN(filterNum)) {
                         if (rangeType === 'min' && itemNum < filterNum) {
                            isVisible = false;
                            break;
                         }
                         if (rangeType === 'max' && itemNum > filterNum) {
                            isVisible = false;
                            break;
                         }
                    }
                } else if(group === 'project-stack' || group === 'paper-tag' || group === 'paper-venue') {
                    // Loose matching for stack/tags/venue (contains), case insensitive
                     if (!itemValue || !itemValue.toLowerCase().includes(filterValue.toLowerCase())) {
                        isVisible = false;
                        break;
                    }
                } else {
                    // Exact matching for others (like area)
                    if (itemValue !== filterValue) {
                        isVisible = false;
                        break; // No need to check other filters for this item
                    }
                }
            }
            }

            // Show or hide the item based on the final visibility status
            if (isVisible) {
                item.classList.remove('hidden-item');
            } else {
                item.classList.add('hidden-item');
            }
        });
    }

    // Custom Dropdown Logic
    function closeAllDropdowns() {
        document.querySelectorAll('.custom-dropdown').forEach(d => d.classList.remove('open'));
    }

    document.addEventListener('click', function(e) {
        // Toggle Dropdown
        if (e.target.closest('.custom-dropdown-toggle')) {
            const dropdown = e.target.closest('.custom-dropdown');
            const wasOpen = dropdown.classList.contains('open');
            closeAllDropdowns(); // Close others
            if (!wasOpen) {
                dropdown.classList.add('open');
            }
            e.stopPropagation();
        } 
        // Select Option
        else if (e.target.closest('.dropdown-option')) {
            const option = e.target.closest('.dropdown-option');
            const dropdown = option.closest('.custom-dropdown');
            const toggle = dropdown.querySelector('.custom-dropdown-toggle');
            const hiddenInput = dropdown.querySelector('input[type="hidden"]');
            
            toggle.textContent = option.textContent;
            hiddenInput.value = option.dataset.value;
            
            // Dispatch change event for applyFilters listeners
            hiddenInput.dispatchEvent(new Event('change'));
            
            closeAllDropdowns();
        }
        // Click outside
        else if (!e.target.closest('.custom-dropdown-menu')) {
            closeAllDropdowns();
        }
    });

    // Dropdown Search
    document.addEventListener('input', function(e) {
        if (e.target.classList.contains('dropdown-search')) {
            const term = e.target.value.toLowerCase();
            const optionsContainer = e.target.nextElementSibling; // .dropdown-options
            const options = optionsContainer.querySelectorAll('.dropdown-option');
            
            options.forEach(opt => {
                const text = opt.textContent.toLowerCase();
                const isAllOption = opt.dataset.value === 'all';
                
                if (isAllOption || text.includes(term)) {
                    opt.style.display = 'block';
                } else {
                    opt.style.display = 'none';
                }
            });
        }
    });

    // Get publication items and filter selects
    // Note: selecting hidden inputs now
    const publication_filterSelects = document.querySelectorAll('.publication-filter-select');
    const publication_items = document.querySelectorAll('.publication-item');
    
    // Populate paper filters dynamically
    if (publication_items.length > 0) {
        populatePaperFilters(publication_items);
    }
    
    // Publication filters on select change
    publication_filterSelects.forEach(select => {
        select.addEventListener('change',  () => {
            applyFilters(publication_filterSelects,publication_items);
        });
    });

    // Get project items and filter selects
    const project_filterSelects = document.querySelectorAll('.project-filter-select');
    const project_items = document.querySelectorAll('.project-item');
    // Apply project filters on select change
    project_filterSelects.forEach(select => {
        select.addEventListener('change',  () => {
            applyFilters(project_filterSelects, project_items);
        });
    });

    // Reset Filters Logic
    document.querySelectorAll('.reset-filters-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const target = this.dataset.target;
            let filterSelects, items;

            if (target === 'project') {
                filterSelects = project_filterSelects;
                items = project_items;
            } else if (target === 'publication') {
                filterSelects = publication_filterSelects;
                items = publication_items;
            }

            if (filterSelects && items) {
                // Reset all filter inputs
                filterSelects.forEach(select => {
                    select.value = 'all';
                    // Reset custom dropdown UI
                    const dropdown = select.closest('.custom-dropdown');
                    if(dropdown) {
                         const toggle = dropdown.querySelector('.custom-dropdown-toggle');
                         if(toggle) toggle.textContent = 'All';
                    }
                });

                // Apply logic (show all)
                applyFilters(filterSelects, items);
            }
        });
    });
});
</script>

