<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Vinayak Sharma Profile">
  <meta name="author" content="Vinayak Sharma">

  <title>{{ site.name }}</title>
  {%- seo title=false -%}
  <link rel="stylesheet" href="{{ '/assets/main.css' | relative_url }}">
  <!-- <link rel="FavIcon" type="image/svg+xml" href="{{ site.favicon | default: '/assets/favicon.svg' | relative_url }}" ,
    id="dynamic-favicon"> -->
  <!-- <link id="favicon" rel="icon" href="{{'/images/fav.svg' | relative_url }}" type="image/svg+xml"> -->

  <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://s.pageclip.co/v1/pageclip.css" media="screen">
  <link rel="stylesheet" href="https://unpkg.com/@coreui/icons@2.0.0-beta.3/css/all.min.css">

  {%- if jekyll.environment == 'production' and site.google_analytics -%}
  {%- include google-analytics.html -%}
  {%- endif -%}
  {%- if jekyll.environment == 'production' and site.gtm -%}
  {%- include gtm_head.html -%}
  {%- endif -%}
  {%- if jekyll.environment == 'production' and site.gtag -%}
  {%- include gtag.html -%}
  {%- endif -%}

  <script>
    const gravatarHash = "{{ site.gravatar_hash }}";
    const gravatarURL = `https://www.gravatar.com/avatar/${gravatarHash}?s=64&d=identicon`;

    function setCircularFavicon(imageUrl) {
      const img = new Image();
      img.crossOrigin = "anonymous";

      img.onload = function () {
        const size = 64;
        const canvas = document.createElement('canvas');
        canvas.width = canvas.height = size;
        const ctx = canvas.getContext('2d');

        // Draw the uploaded image to the canvas
        ctx.drawImage(img, 0, 0, size, size);

        // Get the PNG data URL from the canvas
        const pngBase64 = canvas.toDataURL('image/png');

        // Create an SVG string that includes the PNG and clips it to a circle
        const svg = `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${size} ${size}">
          <defs>
            <clipPath id="circle">
              <circle cx="${size / 2}" cy="${size / 2}" r="${size / 2}"/>
            </clipPath>
          </defs>
          <image width="${size}" height="${size}" href="${pngBase64}" clip-path="url(#circle)"/>
        </svg>`;

        // Encode the SVG string to base64
        const svgBase64 = btoa(svg);
        const faviconUrl = `data:image/svg+xml;base64,${svgBase64}`;

        let favicon = document.querySelector('link[rel="icon"]');
        if (!favicon) {
          favicon = document.createElement('link');
          favicon.rel = 'icon';
          document.head.appendChild(favicon);
        }
        favicon.type = 'image/svg+xml';
        favicon.href = faviconUrl;
      };

      img.onerror = function () {
        console.error("Failed to load Gravatar image.");
      };

      img.src = imageUrl;
    }

    setCircularFavicon(gravatarURL);
  </script>
</head>